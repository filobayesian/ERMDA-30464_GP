
. 
. *============================*
. * PACKAGE INSTALLATION       *
. *============================*
. local packages ftools reghdfe estout coefplot parmest

. foreach pkg of local packages {
  2.     cap which `pkg'
  3.     if _rc ssc install `pkg', replace
  4. }

. 
. *============================*
. *       LOAD DATA            *
. *============================*
. local regions molise basilicata

. local first = 1

. foreach r of local regions {
  2.     if `first' {
  3.         use "Data/derived/`r'_filtered.dta", clear
  4.         local first = 0
  5.     }
  6.     else append using "Data/derived/`r'_filtered.dta"
  7. }

. 
. *============================*
. *   TREATMENT VARIABLES      *
. *============================*
. destring region_res, replace
region_res: all characters numeric; replaced as byte

. cap drop treat_quake post_quake

. 
. gen byte treat_quake = (region_res == 12)

. gen byte post_quake  = (year >= 2003)

. 
. label var treat_quake "Molise resident"

. label var post_quake  "Post 2003"

. *============================*
. *      OUTCOME VARIABLES     *
. *============================*
. // Employment indicator
. cap confirm variable employed

. if _rc gen byte employed = inlist(type, 1, 2, 3) if !missing(t
> ype)

. label var employed "Any employment (probability)"

. 
. // Employment type dummies DA FARE DATA CLEANING SU STATA
. cap drop y_private y_public y_self

. gen byte y_private = (type == 1) if !missing(type)

. gen byte y_public  = (type == 2) if !missing(type)

. gen byte y_self    = (type == 3) if !missing(type)

. 
. label var y_private "Private employment (Pr)"

. label var y_public  "Public employment (Pr)"

. label var y_self    "Self-employment (Pr)"

. 
. // Log wage
. cap drop lnwage

. gen double lnwage = ln(wage + 1)
(14,897 missing values generated)

. 
. // Relative year for event study
. cap drop rel_year

. gen rel_year = year - 2002

. label var rel_year "Year - 2002"

. 
. *============================*
. *   INCOME CATEGORIES        *
. *============================*
. // Current income category DA FARE DATA CLEANING SU STATA
. cap drop income_category

. gen byte income_category = 1 if wage < 28000 & !missing(wage)
(21,674 missing values generated)

. replace income_category = 2 if inrange(wage, 28000, 50000)
(5,477 real changes made)

. replace income_category = 3 if wage > 50000
(16,197 real changes made)

. 
. label define inc3 1 "Low" 2 "Medium" 3 "High"

. label values income_category inc3

. label var income_category "Income category (current)"

. 
. // Baseline income (last pre-quake year)
. cap drop pre baseline_wage base_inc base_inc4

. gen byte pre = (post_quake == 0)

. 
. bys id_worker: egen pre_last_year = max(year) if pre
(43,371 missing values generated)

. gen double baseline_wage = wage if year == pre_last_year
(75,608 missing values generated)

. bys id_worker: egen baseline_wage2 = max(baseline_wage)
(13,750 missing values generated)

. drop baseline_wage pre

. rename baseline_wage2 baseline_wage

. 
. gen byte base_inc = 1 if baseline_wage < 28000
(19,859 missing values generated)

. replace base_inc = 2 if inrange(baseline_wage, 28000, 50000)
(4,808 real changes made)

. replace base_inc = 3 if baseline_wage > 50000
(15,051 real changes made)

. 
. gen byte base_inc4 = cond(missing(base_inc), 4, base_inc)

. 
. label define baseinc4 1 "Low (pre)" 2 "Med (pre)" 3 "High (pre
> )" 4 "Unknown (pre)"

. label values base_inc4 baseinc4

. label var base_inc4 "Baseline income (4 cats incl. Unknown)"

. 
. // Joint outcomes: employed AND income category
. cap drop y_emp_*

. gen byte y_emp_low     = (employed == 1 & income_category == 1
> )

. gen byte y_emp_med     = (employed == 1 & income_category == 2
> )

. gen byte y_emp_high    = (employed == 1 & income_category == 3
> )

. gen byte y_emp_unknown = (employed == 1 & missing(income_categ
> ory))

. 
. label var y_emp_low     "Pr(emp ∧ low)"

. label var y_emp_med     "Pr(emp ∧ med)"

. label var y_emp_high    "Pr(emp ∧ high)"

. label var y_emp_unknown "Pr(emp ∧ unknown)"

. 
. *============================*
. *    REGRESSION ANALYSES     *
. *============================*
. local outcomes employed wage lnwage

. local absorb_spec absorb(year region_res) vce(cluster id_worke
> r)

. 
. // (A) Region-based DiD
. foreach y of local outcomes {
  2.     qui count if !missing(`y')
  3.     if r(N) > 0 {
  4.         eststo A_`y': reghdfe `y' i.post_quake##i.treat_qua
> ke, `absorb_spec'
  5.         estadd local model "A: Region DiD", replace
  6.         estadd local depvar "`y'", replace
  7.     }
  8. }
(MWFE estimator converged in 3 iterations)
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       7.60
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0058
                                                  R-squared     
>   =     0.0060
                                                  Adj R-squared 
>   =     0.0059
                                                  Within R-sq.  
>   =     0.0001
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.3733

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.post_quake |          0  (omitted)
1.treat_qu~e |          0  (omitted)
             |
  post_quake#|
 treat_quake |
        1 1  |   -.013644   .0049496    -2.76   0.006    -.02334
> 58                                                            
>      -.0039421
             |
       _cons |   .8338085   .0023484   355.06   0.000     .82920
> 54                                                            
>       .8384116
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "A: Region DiD"

added macro:
             e(depvar) : "employed"
(MWFE estimator converged in 3 iterations)
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )

HDFE Linear regression                            Number of obs 
>   =     73,482
Absorbing 2 HDFE groups                           F(   1,  14767
> )                                                             
>   =       2.54
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.1109
                                                  R-squared     
>   =     0.0125
                                                  Adj R-squared 
>   =     0.0124
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     14,768       Root MSE      
>   = 11669.2304

                         (Std. err. adjusted for 14,768 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
        wage | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.post_quake |          0  (omitted)
1.treat_qu~e |          0  (omitted)
             |
  post_quake#|
 treat_quake |
        1 1  |  -183.5382   115.1287    -1.59   0.111    -409.20
> 48                                                            
>       42.12836
             |
       _cons |   15885.36   95.90441   165.64   0.000     15697.
> 38                                                            
>       16073.35
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "A: Region DiD"

added macro:
             e(depvar) : "wage"
(MWFE estimator converged in 3 iterations)
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )

HDFE Linear regression                            Number of obs 
>   =     73,482
Absorbing 2 HDFE groups                           F(   1,  14767
> )                                                             
>   =       1.79
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.1811
                                                  R-squared     
>   =     0.0135
                                                  Adj R-squared 
>   =     0.0134
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     14,768       Root MSE      
>   =     1.0282

                         (Std. err. adjusted for 14,768 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
      lnwage | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.post_quake |          0  (omitted)
1.treat_qu~e |          0  (omitted)
             |
  post_quake#|
 treat_quake |
        1 1  |  -.0179363     .01341    -1.34   0.181    -.04422
> 16                                                            
>        .008349
             |
       _cons |    9.34327   .0070542  1324.49   0.000     9.3294
> 43                                                            
>       9.357097
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "A: Region DiD"

added macro:
             e(depvar) : "lnwage"

. 
. // (B) Employment type LPM DiD
. foreach y in y_private y_public y_self {
  2.     eststo B_`y': reghdfe `y' i.treat_quake##i.post_quake, 
> `absorb_spec'
  3.     estadd local model "B: Type-specific LPM DiD", replace
  4.     estadd local depvar "`y'", replace
  5.     
.     qui margins treat_quake#post_quake
  6.     qui lincom 1.treat_quake#1.post_quake
  7. }
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       0.76
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.3826
                                                  R-squared     
>   =     0.0038
                                                  Adj R-squared 
>   =     0.0037
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.4863

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
   y_private | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0045199   .0051764    -0.87   0.383    -.01466
> 62                                                            
>       .0056264
             |
       _cons |   .6131806   .0035063   174.88   0.000     .60630
> 78                                                            
>       .6200534
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "B: Type-specific LPM DiD"

added macro:
             e(depvar) : "y_private"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =      19.99
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0000
                                                  R-squared     
>   =     0.0002
                                                  Adj R-squared 
>   =     0.0001
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.3256

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    y_public | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0085137    .001904    -4.47   0.000    -.01224
> 58                                                            
>      -.0047816
             |
       _cons |   .1220258   .0026028    46.88   0.000      .1169
> 24                                                            
>       .1271275
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "B: Type-specific LPM DiD"

added macro:
             e(depvar) : "y_public"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       0.03
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.8516
                                                  R-squared     
>   =     0.0009
                                                  Adj R-squared 
>   =     0.0009
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.2979

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
      y_self | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0006103   .0032634    -0.19   0.852     -.0070
> 07                                                            
>       .0057863
             |
       _cons |   .0986021   .0022201    44.41   0.000     .09425
> 05                                                            
>       .1029538
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "B: Type-specific LPM DiD"

added macro:
             e(depvar) : "y_self"

. 
. // (D) Baseline income heterogeneity
. eststo D_pooled: reghdfe employed i.treat_quake##i.post_quake#
> #i.base_inc4, `absorb_spec'
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   9,  15195
> )                                                             
>   =    1046.30
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0000
                                                  R-squared     
>   =     0.2778
                                                  Adj R-squared 
>   =     0.2777
                                                  Within R-sq.  
>   =     0.2735
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.3182

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0110274    .005089    -2.17   0.030    -.02100
> 24                                                            
>      -.0010524
             |
   base_inc4 |
  Med (pre)  |   .0492217   .0035898    13.71   0.000     .04218
> 53                                                            
>       .0562581
 High (pre)  |  -.5187363   .0072876   -71.18   0.000    -.53302
> 08                                                            
>      -.5044517
             |
 treat_quake#|
   base_inc4 |
1#Med (pre)  |  -.0090147   .0060015    -1.50   0.133    -.02077
> 84                                                            
>       .0027489
          1 #|
 High (pre)  |   .0062045   .0122914     0.50   0.614    -.01788
> 82                                                            
>       .0302971
             |
  post_quake#|
   base_inc4 |
1#Med (pre)  |   .0260446   .0068556     3.80   0.000     .01260
> 69                                                            
>       .0394823
          1 #|
 High (pre)  |   .0061971   .0105747     0.59   0.558    -.01453
> 06                                                            
>       .0269247
             |
 treat_quake#|
  post_quake#|
   base_inc4 |
          1 #|
          1 #|
  Med (pre)  |  -.0279897   .0127851    -2.19   0.029      -.053
> 05                                                            
>      -.0029294
          1 #|
          1 #|
 High (pre)  |  -.0070193   .0174251    -0.40   0.687    -.04117
> 45                                                            
>        .027136
             |
       _cons |   .9181309   .0016724   548.98   0.000     .91485
> 27                                                            
>       .9214091
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

. estadd local model "D: Baseline income DDD", replace

added macro:
              e(model) : "D: Baseline income DDD"

. estadd local depvar "employed", replace

added macro:
             e(depvar) : "employed"

. 
. forvalues c = 1/3 {
  2.     eststo D_bin`c': reghdfe employed i.treat_quake##i.post
> _quake if base_inc == `c', `absorb_spec'
  3.     estadd local model "D: DiD within baseline bin `c'", re
> place
  4.     estadd local depvar "employed", replace
  5.     
.     qui margins treat_quake#post_quake
  6.     qui lincom 1.treat_quake#1.post_quake
  7. }
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     68,520
Absorbing 2 HDFE groups                           F(   1,  11730
> )                                                             
>   =       4.74
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0295
                                                  R-squared     
>   =     0.0320
                                                  Adj R-squared 
>   =     0.0319
                                                  Within R-sq.  
>   =     0.0001
Number of clusters (id_worker) =     11,731       Root MSE      
>   =     0.2727

                         (Std. err. adjusted for 11,731 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0110806   .0050903    -2.18   0.030    -.02105
> 84                                                            
>      -.0011028
             |
       _cons |   .9180516   .0016741   548.39   0.000     .91477
> 01                                                            
>       .9213331
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "D: DiD within baseline bin 1"

added macro:
             e(depvar) : "employed"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =      4,808
Absorbing 2 HDFE groups                           F(   1,    818
> )                                                             
>   =      10.93
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0010
                                                  R-squared     
>   =     0.0399
                                                  Adj R-squared 
>   =     0.0385
                                                  Within R-sq.  
>   =     0.0031
Number of clusters (id_worker) =        819       Root MSE      
>   =     0.1694

                            (Std. err. adjusted for 819 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0388243   .0117443    -3.31   0.001    -.06187
> 69                                                            
>      -.0157718
             |
       _cons |   .9767761   .0032256   302.82   0.000     .97044
> 46                                                            
>       .9831076
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "D: DiD within baseline bin 2"

added macro:
             e(depvar) : "employed"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     15,051
Absorbing 2 HDFE groups                           F(   1,   2645
> )                                                             
>   =       1.05
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.3058
                                                  R-squared     
>   =     0.1289
                                                  Adj R-squared 
>   =     0.1285
                                                  Within R-sq.  
>   =     0.0001
Number of clusters (id_worker) =      2,646       Root MSE      
>   =     0.4577

                          (Std. err. adjusted for 2,646 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0171056   .0166997    -1.02   0.306    -.04985
> 15                                                            
>       .0156403
             |
       _cons |   .4047671   .0066056    61.28   0.000     .39181
> 45                                                            
>       .4177197
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "D: DiD within baseline bin 3"

added macro:
             e(depvar) : "employed"

. 
. // (E) Joint outcomes DiD
. foreach y in y_emp_low y_emp_med y_emp_high y_emp_unknown {
  2.     eststo E_`y': reghdfe `y' i.treat_quake##i.post_quake, 
> `absorb_spec'
  3.     estadd local model "E: Joint outcome DiD", replace
  4.     estadd local depvar "`y'", replace
  5.     
.     qui margins treat_quake#post_quake
  6.     qui lincom 1.treat_quake#1.post_quake
  7. }
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       3.05
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0806
                                                  R-squared     
>   =     0.0109
                                                  Adj R-squared 
>   =     0.0108
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.4279

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
   y_emp_low | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0097282   .0055679    -1.75   0.081    -.02064
> 21                                                            
>       .0011856
             |
       _cons |   .7564482   .0027767   272.43   0.000     .75100
> 56                                                            
>       .7618908
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "E: Joint outcome DiD"

added macro:
             e(depvar) : "y_emp_low"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       1.13
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.2876
                                                  R-squared     
>   =     0.0055
                                                  Adj R-squared 
>   =     0.0054
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.2404

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
   y_emp_med | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0032886   .0030926    -1.06   0.288    -.00935
> 04                                                            
>       .0027732
             |
       _cons |   .0625422   .0016808    37.21   0.000     .05924
> 77                                                            
>       .0658367
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "E: Joint outcome DiD"

added macro:
             e(depvar) : "y_emp_med"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =       0.28
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.5938
                                                  R-squared     
>   =     0.0002
                                                  Adj R-squared 
>   =     0.0001
                                                  Within R-sq.  
>   =     0.0000
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.1204

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
  y_emp_high | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |  -.0006271   .0011758    -0.53   0.594    -.00293
> 18                                                            
>       .0016775
             |
       _cons |   .0148182   .0009079    16.32   0.000     .01303
> 85                                                            
>       .0165978
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "E: Joint outcome DiD"

added macro:
             e(depvar) : "y_emp_high"
(MWFE estimator converged in 3 iterations)
note: 1bn.treat_quake is probably collinear with the fixed effec
> ts (all partialled-out values are close to zero; tol = 1.0e-09
> )
note: 1bn.post_quake is probably collinear with the fixed effect
> s (all partialled-out values are close to zero; tol = 1.0e-09)
warning: missing F statistic; dropped variables due to collinear
> ity or too few clusters

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   1,  15195
> )                                                             
>   =          .
Statistics robust to heteroskedasticity           Prob > F      
>   =          .
                                                  Root MSE      
>   =     0.0000
Number of clusters (id_worker) =     15,196

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
y_emp_unkn~n | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
1.treat_qu~e |          0  (omitted)
1.post_quake |          0  (omitted)
             |
 treat_quake#|
  post_quake |
        1 1  |          0  (omitted)
             |
       _cons |          0  (omitted)
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "E: Joint outcome DiD"

added macro:
             e(depvar) : "y_emp_unknown"

. 
. *============================*
. *   EVENT STUDY (DYNAMIC)    *
. *============================*
. // Event study program
. cap program drop _evtstore

. program define _evtstore
  1.     syntax, Filepath(string)
  2.     parmest, norestore
  3.     keep if strpos(parm, "event_") == 1
  4.     
.     gen str10 rel_str = subinstr(parm, "event_", "", 1)
  5.     replace rel_str = subinstr(rel_str, "m", "-", 1)
  6.     gen rel = real(rel_str)
  7.     
.     rename (estimate min95 max95) (beta ci_lo ci_hi)
  8.     keep rel beta ci_lo ci_hi
  9.     sort rel
 10.     
.     export delimited using "`filepath'", replace
 11. end

. 
. // Run event studies - preserve for each outcome
. cap mkdir "$OUT"

. foreach y of local outcomes {
  2.     preserve
  3.     keep if inrange(rel_year, -5, 5)
  4.     
.     // Generate event dummies (omitting -1)
.     cap drop event_*
  5.     forval k = -5/5 {
  6.         if `k' != -1 {
  7.             local suffix = cond(`k' < 0, "m" + string(abs(`
> k')), string(`k'))
  8.             gen byte event_`suffix' = (rel_year == `k' & tr
> eat_quake == 1)
  9.         }
 10.     }
 11.     
.     cap confirm variable `y'
 12.     if !_rc {
 13.         qui count if !missing(`y')
 14.         if r(N) > 0 {
 15.             eststo C_`y': reghdfe `y' event_*, `absorb_spec
> '
 16.             estadd local model "C: Dynamic DiD", replace
 17.             estadd local depvar "`y'", replace
 18.             
.             qui _evtstore, filepath("$OUT/eventstudy_`y'.csv")
 19.             
.             cap coefplot, keep(event_*) vertical xline(0, lp(d
> ash)) ///
>                 ciopts(recast(rcap)) title("Event study: `y'")
>  ///
>                 ytitle("Effect vs rel_year=-1") xtitle("Relati
> ve year")
 20.             if !_rc graph export "$OUT/eventstudy_`y'.png",
>  replace
 21.         }
 22.     }
 23.     restore
 24. }
(0 observations deleted)
(MWFE estimator converged in 3 iterations)
note: event_m5 omitted because of collinearity
note: event_m4 omitted because of collinearity
note: event_m3 omitted because of collinearity
note: event_4 omitted because of collinearity
note: event_5 omitted because of collinearity

HDFE Linear regression                            Number of obs 
>   =     88,379
Absorbing 2 HDFE groups                           F(   5,  15195
> )                                                             
>   =       5.74
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0000
                                                  R-squared     
>   =     0.0061
                                                  Adj R-squared 
>   =     0.0060
                                                  Within R-sq.  
>   =     0.0002
Number of clusters (id_worker) =     15,196       Root MSE      
>   =     0.3732

                         (Std. err. adjusted for 15,196 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
    employed | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
    event_m5 |          0  (omitted)
    event_m4 |          0  (omitted)
    event_m3 |          0  (omitted)
    event_m2 |   .0039465   .0072699     0.54   0.587    -.01030
> 33                                                            
>       .0181963
     event_0 |  -.0065029   .0057937    -1.12   0.262    -.01785
> 92                                                            
>       .0048534
     event_1 |  -.0074784   .0065344    -1.14   0.252    -.02028
> 66                                                            
>       .0053299
     event_2 |  -.0042386   .0070177    -0.60   0.546    -.01799
> 41                                                            
>       .0095168
     event_3 |  -.0320318   .0075581    -4.24   0.000    -.04684
> 65                                                            
>       -.017217
     event_4 |          0  (omitted)
     event_5 |          0  (omitted)
       _cons |   .8340973   .0026618   313.35   0.000     .82887
> 98                                                            
>       .8393148
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "C: Dynamic DiD"

added macro:
             e(depvar) : "employed"
file
    /Users/vittoriogaravelli/GitHub/GitHub/ERMDA-30464_GP/outp
    > ut/eventstudy_employed.png saved as PNG format
(0 observations deleted)
(MWFE estimator converged in 3 iterations)
note: event_m5 omitted because of collinearity
note: event_m4 omitted because of collinearity
note: event_m3 omitted because of collinearity
note: event_4 omitted because of collinearity
note: event_5 omitted because of collinearity

HDFE Linear regression                            Number of obs 
>   =     73,482
Absorbing 2 HDFE groups                           F(   5,  14767
> )                                                             
>   =       8.15
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0000
                                                  R-squared     
>   =     0.0126
                                                  Adj R-squared 
>   =     0.0125
                                                  Within R-sq.  
>   =     0.0002
Number of clusters (id_worker) =     14,768       Root MSE      
>   = 11668.5170

                         (Std. err. adjusted for 14,768 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
        wage | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
    event_m5 |          0  (omitted)
    event_m4 |          0  (omitted)
    event_m3 |          0  (omitted)
    event_m2 |  -23.38341   140.9719    -0.17   0.868    -299.70
> 59                                                            
>       252.9391
     event_0 |  -50.74238   129.5566    -0.39   0.695    -304.68
> 95                                                            
>       203.2047
     event_1 |   207.8753   145.5215     1.43   0.153    -77.365
> 02                                                            
>       493.1157
     event_2 |   6.737911   165.9862     0.04   0.968    -318.61
> 58                                                            
>       332.0916
     event_3 |   -883.031   186.5487    -4.73   0.000     -1248.
> 69                                                            
>      -517.3723
     event_4 |          0  (omitted)
     event_5 |          0  (omitted)
       _cons |   15893.48    99.3824   159.92   0.000     15698.
> 68                                                            
>       16088.29
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "C: Dynamic DiD"

added macro:
             e(depvar) : "wage"
file
    /Users/vittoriogaravelli/GitHub/GitHub/ERMDA-30464_GP/outp
    > ut/eventstudy_wage.png saved as PNG format
(0 observations deleted)
(MWFE estimator converged in 3 iterations)
note: event_m5 omitted because of collinearity
note: event_m4 omitted because of collinearity
note: event_m3 omitted because of collinearity
note: event_4 omitted because of collinearity
note: event_5 omitted because of collinearity

HDFE Linear regression                            Number of obs 
>   =     73,482
Absorbing 2 HDFE groups                           F(   5,  14767
> )                                                             
>   =       1.90
Statistics robust to heteroskedasticity           Prob > F      
>   =     0.0905
                                                  R-squared     
>   =     0.0136
                                                  Adj R-squared 
>   =     0.0134
                                                  Within R-sq.  
>   =     0.0001
Number of clusters (id_worker) =     14,768       Root MSE      
>   =     1.0282

                         (Std. err. adjusted for 14,768 clusters
>  in id_worker)
----------------------------------------------------------------
> --------------
             |               Robust
      lnwage | Coefficient  std. err.      t    P>|t|     [95% c
> on                                                            
>   f. interval]
-------------+--------------------------------------------------
> --------------
    event_m5 |          0  (omitted)
    event_m4 |          0  (omitted)
    event_m3 |          0  (omitted)
    event_m2 |  -.0210161   .0220495    -0.95   0.341    -.06423
> 59                                                            
>       .0222036
     event_0 |  -.0159099   .0192923    -0.82   0.410    -.05372
> 52                                                            
>       .0219055
     event_1 |   .0009053   .0204872     0.04   0.965    -.03925
> 21                                                            
>       .0410627
     event_2 |  -.0466547   .0223459    -2.09   0.037    -.09045
> 53                                                            
>       -.002854
     event_3 |  -.0460292   .0214853    -2.14   0.032    -.08814
> 31                                                            
>      -.0039153
     event_4 |          0  (omitted)
     event_5 |          0  (omitted)
       _cons |   9.347536   .0081749  1143.44   0.000     9.3315
> 12                                                            
>        9.36356
----------------------------------------------------------------
> --------------

Absorbed degrees of freedom:
-----------------------------------------------------+
 Absorbed FE | Categories  - Redundant  = Num. Coefs |
-------------+---------------------------------------|
        year |         6           0           6     |
  region_res |         2           1           1     |
-----------------------------------------------------+

added macro:
              e(model) : "C: Dynamic DiD"

added macro:
             e(depvar) : "lnwage"
file
    /Users/vittoriogaravelli/GitHub/GitHub/ERMDA-30464_GP/outp
    > ut/eventstudy_lnwage.png saved as PNG format

. 
. *============================*
. *      EXPORT RESULTS        *
. *============================*
. local star_spec star(* 0.10 ** 0.05 *** 0.01)

. local table_opts replace se r2 ar2 label nonotes b(%9.4f) se(%
> 9.4f) `star_spec'

. 
. // Block-specific tables
. esttab D_pooled D_bin1 D_bin2 D_bin3 using "$OUT/results_D_bas
> eline_income.txt", ///
>     `table_opts' title("D — Baseline income heterogeneity")
(output written to output/results_D_baseline_income.txt)

. 
. esttab E_y_emp_* using "$OUT/results_E_joint_outcomes.txt", //
> /
>     `table_opts' title("E — Joint outcomes: Pr(emp & income bi
> n)")
(output written to output/results_E_joint_outcomes.txt)

. 
. // Master table
. esttab A_* B_* C_* D_* E_* using "$OUT/results_ALL.txt", ///
>     `table_opts' nogap nogaps ///
>     title("A/B/C/D/E — Region DiD, Type LPM, Dynamic, Baseline
>  Income, Joint Outcomes")
(output written to output/results_ALL.txt)

. 
. log close _all
      name:  <unnamed>
       log:  /Users/vittoriogaravelli/GitHub/GitHub/ERMDA-30464_
> GP/output/empirical_00_05.log
  log type:  text
 closed on:  15 Nov 2025, 19:36:29
----------------------------------------------------------------
